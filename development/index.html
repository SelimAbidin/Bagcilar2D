<html>
<head>
  <meta charset="utf-8">
  <title>Empty</title>
</head>

<script id="vertexShader" type="x-shader/x-vertex">

    uniform mat3 modelMatrix;  
    uniform mat3 projectionMatrix;  
    uniform mat3 viewMatrix;  
    uniform mat3 ppMatrix;  
    attribute vec2 position;     
    attribute vec2 offset;
    attribute vec4 color;
    attribute float rotation;
    attribute float order;
    varying vec4 colorVar;
    varying mat3 testVar;
    varying vec3 posVar;

    mat3 getPositionMatrix (float posX, float posY){ 
        
        mat3 translateMat = mat3( 
                                    1.0,  0.0,  0.0,
                                    0.0,  1.0,  0.0, 
                                    posX,  posY,  1.0 
                                    ); 
        return translateMat;
    } 

    mat3 getRotationMatrix(float r){

        mat3 rotationM = mat3( 
                            cos(r),   sin(r), 0.0, 
                            -sin(r),   cos(r), 0.0, 
                            0.0,         0.0,      1.0 
                            );


        return rotationM;   
    }  


    void main() {

        vec3 pos3V = vec3(position.x ,position.y, 1.0);

        mat3 positionMatrix = getPositionMatrix(offset.x, offset.y);
        mat3 rotationMatrix = getRotationMatrix(rotation);
        float temp = offset.x;
        mat3 modelMat3 =  positionMatrix * rotationMatrix;
        mat3 m =  projectionMatrix * (modelMat3 * viewMatrix);
        vec3 pm = m * pos3V;
        colorVar = vec4(color.x , rotation, order, 1.0);
        testVar = m;
        posVar = vec3(abs(cos(rotation)), abs(cos(rotation + 0.1)), abs(cos(rotation + 0.7))) ;
        gl_Position = vec4(pm.x, pm.y, order, 1.0);

    }
</script>


<script id="vertexShaderInstanced" type="x-shader/x-vertex">

    uniform mat3 projectionMatrix; 
    uniform mat3 viewMatrix;
    attribute vec2 position;
    attribute vec2 offset;
    attribute float rotation;
    attribute vec3 color;
    varying vec3 colorVar;

    mat3 getRotationMatrix(float r){
        mat3 rotationM = mat3(
                            cos(r),   sin(r),       0.0,
                            -sin(r),   cos(r),      0.0,
                            0.0,         0.0,       1.0
                            );


        return rotationM;
    } 

    mat3 getPositionMatrix (float posX, float posY){ 

        mat3 translateMat = mat3(
                                    1.0,  0.0,  0.0,
                                    0.0,  1.0,  0.0,
                                    posX,  posY,  1.0
                                    );
        return translateMat;
    } 

    void main() {
        
        colorVar = color;
        vec3 pos3V = vec3(position.x, position.y, 1.0);
        mat3 modelMatrix = getPositionMatrix(offset.x, offset.y) * getRotationMatrix(rotation);
        mat3 modeViewProjection =  projectionMatrix * viewMatrix * modelMatrix;

        mat3 mm = mat3(
            1,0,0,
            0,1,0,
            0,0,1
        );
        
        float xx = offset.x + rotation;
        vec3 worlPosition = modeViewProjection * pos3V;
        gl_Position = vec4(worlPosition.x, worlPosition.y, -0.1, 1.0);

    }
</script>

<script id="fragmentShaderInstanced" type="x-shader/x-fragment">
    precision mediump float;
    varying vec3 colorVar;
    void main() {        
        gl_FragColor = vec4(colorVar,1.0);
    }
</script>



<script src="../build/Bagcilar2d.js" ></script>

<script>

    // 0.00392156863      0                 0
    // 0                  0.00392156863     0
    // 0                  0                 1



    // 0.00392156863      0                 0
    // 0                  0.00392156863     0
    // 0.00392156863      0                 1


    function init(){
        window.b = new Bagcilar.EventableObject();

      

        window.meydan = new Bagcilar.Square("renderCanvas");
        window.meydan.addEventListener(Bagcilar.Square.ENTER_FRAME, this, enterFrame);
        meydan.camera = new Bagcilar.Camera();
        //meydan.setAutoUpdate(false);
        //var a =  new Bagcilar.TestSprite();
        //meydan.addChild(a);
        
        // setInterval(function(){

        //     meydan.update();

        // },1000);
        // var b =  new Bagcilar.TestSprite();
        // b.g = 1;
        // meydan.addChild(b);
        // a.zv = 200;
        // b.zv = 100;
        var color2 = new Bagcilar.Color(0,1,0,1);
        
    //     window.quad = new Bagcilar.Sprite({material:new Bagcilar.InstancedMaterial()});
    //    //  window.quad = new Bagcilar.Quad({material:new Bagcilar.ColorEffect(color2)});
    //     quad.name = "quad";
    //     quad.x = 110;
    //     quad.rotation = Math.PI / 0.3;
       // meydan.addChild(quad);

        
        // 
        // window.quad2 = new Bagcilar.Quad({material:new Bagcilar.ColorEffect(color2)});
        // meydan.addChild(quad2);
        // quad2.name = "quad2";
        
        var sprites = [];
        window.ekle = function (){

            var sprite = new Bagcilar.Sprite();

            // sprite.x = (Math.random() * 600) - 300;;
            // sprite.y = (Math.random() * 600) - 300;
            sprite.x = 0;
            sprite.y = 0;
            sprite.name = "id_"+sprites.length;
            sprite.speed = Math.random() * 33;
            sprite.vx = Math.sin(Math.random() * (Math.PI * 2)) * 10;
            sprite.vy = Math.sin(Math.random() * (Math.PI * 2)) * 10;
            sprite.rv = sprite.vy * .2; 
            meydan.addChild(sprite);
            sprites.push(sprite);
        }
        ekle();
        var rad = 0;
        function enterFrame(event) {
            rad += 0.1;

            var sp;
            for(var i = 0 ; i < sprites.length; i++){

                sp = sprites[i];
                
                sp.y += sp.vy;
                sp.x += sp.vx;
                sp.rotation += sp.rv;
                
                
                if(sp.x >= 300){
                    sp.x = 300;
                    sp.vx *= -1;
                } else if(sp.x <= -300) {
                    sp.x = -300;
                    sp.vx *= -1;
                } else if(sp.y >= 300){
                    sp.y = 300;
                    sp.vy *= -1;
                    sp.rv = sp.vy * .2;
                } else if(sp.y <= -300) {
                    sp.y = -300;
                    sp.vy *= -1;
                    sp.rv = sp.vy * .2;
                }
                
            }

            // quad.setScaleX(Math.cos(rad) * 5);
            //quad.x = Math.cos(rad) * 200; 
            // quad.y = rad;
            // quad.setRotation(quad.getRotation() + 0.01);
            // quad2.x =(Math.sin(rad) * 100);
        }
        
        window.m3x3 = new Bagcilar.Matrix3();
    }
    

</script>
<body onload="init()">

<canvas id="renderCanvas" width="600" height="600" ></canvas>

<div id="framef"></div>
<div id="frameMax"></div>
</body>
</html>