!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Bagcilar=e():t.Bagcilar=e()}(window,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var i=function(){function t(){this.id="id_"+t.__indexCounter++}return t.__indexCounter=0,Object.assign(t.prototype,{toString:function(){var t=this.constructor.toString();return"["+(t=(t=t.substr("function".length)).substr(0,t.indexOf("("))).trim()+" Object]"}}),t}();function a(t,e,r,a){i.apply(this,arguments),void 0===a&&(a=0),this.priority=a,this.type=t,this.listener=r,this.context=e}function s(){i.apply(this,arguments),this._listeners={}}function o(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}function n(t,e){t.uniformMatrix3fv(e.location,!1,e.value)}function h(t,e){t.uniform4fv(e.location,e.value)}function c(t,e){e.value instanceof Int32Array?t.uniform1iv(e.location,e.value):t.uniform1i(e.location,e.value)}a.prototype=Object.assign(Object.create(i.prototype),{constructor:a}),s.prototype=Object.assign(Object.create(i.prototype),{constructor:s,addEventListener:function(t,e,r,i){void 0===this._listeners&&(this._listeners={}),void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(new a(t,e,r,i)),this._listeners[t].sort(o)},dispacthEvent:function(t,e){if(this._listeners[t])for(var r,i=this._listeners[t],a=0;a<i.length;a++)(r=i[a]).listener.apply(r.context,[{type:r.type,target:this,data:e}])}});class u extends s{constructor(t,e){super(),this.uniMaps={},this._program=e;for(var r=t.getProgramParameter(this._program,t.ACTIVE_UNIFORMS),i=0;i<r;i++){var a=t.getActiveUniform(this._program,i),s=t.getUniformLocation(this._program,a.name);this.addUniform(s,a)}}getSetter(t){switch(t){case 35675:return n;case 35666:return h;case 35678:return c}}addUniform(t,e){this.uniMaps[e.name]={setter:this.getSetter(e.type),location:t}}setValue(t,e){this.uniMaps.hasOwnProperty(t)&&(this.uniMaps[t].value=e)}getValue(t){if(this.uniMaps.hasOwnProperty(t))return this.uniMaps[t].value}update(t){for(var e in this.uniMaps){var r=this.uniMaps[e];r.effect=this.effect,r.setter(t,r)}}}class f{constructor(t,e){this.x=t,this.y=e}mulMatrix3(t){var e=this.x,r=this.y,i=t.matrixArray;this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this.w=i[2]*e+i[5]*r+i[8]}}class d{constructor(t,e,r){this.x=void 0===t?0:t,this.y=void 0===e?0:e,this.w=void 0===r?0:r}multiplyMat3(t){var e=this.x,r=this.y,i=this.w,a=t.matrixArray;return this.x=a[0]*e+a[3]*r+a[6]*i,this.y=a[1]*e+a[4]*r+a[7]*i,this.w=a[2]*e+a[5]*r+a[8]*i,this}}class l{constructor(){this.matrixArray=[1,0,0,0,1,0,0,0,1]}makeIdentity(){this.setMatrix(1,0,0,0,1,0,0,0,1)}setMatrix(t,e,r,i,a,s,o,n,h){var c=this.matrixArray;c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=a,c[5]=s,c[6]=o,c[7]=n,c[8]=h}setRotationZ(t){var e=this.matrixArray;let r=Math.cos(t),i=Math.sin(t);e[0]=r,e[1]=i,e[3]=-i,e[4]=r}setScale(t,e){var r=this.matrixArray;r[0]=t,r[4]=e}translate(t,e){let r=this.matrixArray;r[6]=t,r[7]=e}multiplyMatrix(t){var e=this.matrixArray,r=t.matrixArray,i=e[0],a=e[3],s=e[6],o=e[1],n=e[4],h=e[7],c=e[2],u=e[5],f=e[8],d=r[0],l=r[3],m=r[6],v=r[1],x=r[4],p=r[7],g=r[2],A=r[5],E=r[8];return e[0]=i*d+a*v+s*g,e[3]=i*l+a*x+s*A,e[6]=i*m+a*p+s*E,e[1]=o*d+n*v+h*g,e[4]=o*l+n*x+h*A,e[7]=o*m+n*p+h*E,e[2]=c*d+u*v+f*g,e[5]=c*l+u*x+f*A,e[8]=c*m+u*p+f*E,this}makeOrtho(t,e,r,i){let a=this.matrixArray;a[0]=2/(e-t),a[4]=2/(r-i),a[6]=-(e+t)/(e-t),a[7]=-(r+i)/(r-i)}multiplySRTMatrix(t,e,r){t=t.matrixArray,e=e.matrixArray,r=r.matrixArray;var i=t[0],a=t[3],s=t[6],o=t[1],n=t[4],h=t[7],c=t[2],u=t[5],f=t[8],d=e[0],l=e[3],m=e[6],v=e[1],x=e[4],p=e[7],g=e[2],A=e[5],E=e[8],R=r[0],S=r[3],_=r[6],T=r[1],b=r[4],y=r[7],M=r[2],B=r[5],L=r[8],P=i*d+a*v+s*g,D=i*l+a*x+s*A,F=i*m+a*p+s*E,U=o*d+n*v+h*g,w=o*l+n*x+h*A,I=o*m+n*p+h*E,O=c*d+u*v+f*g,C=c*l+u*x+f*A,X=c*m+u*p+f*E;this.matrixArray[0]=P*R+D*T+F*M,this.matrixArray[1]=P*S+D*b+F*B,this.matrixArray[2]=P*_+D*y+F*L,this.matrixArray[3]=U*R+w*T+I*M,this.matrixArray[4]=U*S+w*b+I*B,this.matrixArray[5]=U*_+w*y+I*L,this.matrixArray[6]=O*R+C*T+X*M,this.matrixArray[7]=O*S+C*b+X*B,this.matrixArray[8]=O*_+C*y+X*L}}class m extends s{constructor(t,e,r,i){super(),this.elements=[],this.elements[0]=void 0===t?1:t,this.elements[1]=void 0===e?1:e,this.elements[2]=void 0===r?1:r,this.elements[3]=void 0===i?1:i}}class v{constructor(){this.isUploaded=!1}upload(t){if(this.fragmentShaderBuffer=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this.fragmentShaderBuffer,"void main() {   gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);}"),t.compileShader(this.fragmentShaderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}if(this.vertexSahderBuffer=t.createShader(t.VERTEX_SHADER),t.shaderSource(this.vertexSahderBuffer,"uniform mat3 modelMatrix;uniform mat3 projectionMatrix;uniform mat3 viewMatrix;attribute vec2 position;void main() {   vec3 pos = vec3(position.x,position.y, 0.0);   mat3 m =  projectionMatrix * (modelMatrix * viewMatrix);   vec3 pm = m * pos;   gl_Position = vec4(pm, 1.0);   gl_PointSize = 10.0;}"),t.compileShader(this.vertexSahderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,this.vertexSahderBuffer),t.attachShader(this.shaderProgram,this.fragmentShaderBuffer),t.linkProgram(this.shaderProgram),this.uniform=new u(t,this.shaderProgram),this.isUploaded=!0}draw(t){this.shaderProgram||this.upload(t),t.useProgram(this.shaderProgram),this.uniform.update(t)}}var x=0,p=14e3;class g extends v{constructor(){super(),this.count=0,this.id="id_"+x++,this.isUploaded=!1,this.textures=[];var t,e,r,i=20,a=0;this.vertexDataCount=32,this.vertices=new Float32Array(32*p),this.indices=new Uint16Array(6*p);for(let a=0;a<this.vertices.length;a+=32){var s=Math.floor(4*Math.random());this.vertices[a]=-i,this.vertices[a+1]=i,this.vertices[a+2]=s,this.vertices[a+3]=0,this.vertices[a+4]=1,t=Math.random(),e=Math.random(),r=Math.random(),this.vertices[a+5]=t,this.vertices[a+6]=e,this.vertices[a+7]=r,this.vertices[a+8]=-i,this.vertices[a+9]=-i,this.vertices[a+10]=s,this.vertices[a+11]=0,this.vertices[a+12]=0,this.vertices[a+13]=t,this.vertices[a+14]=e,this.vertices[a+15]=r,this.vertices[a+16]=i,this.vertices[a+17]=i,this.vertices[a+18]=s,this.vertices[a+19]=1,this.vertices[a+20]=1,this.vertices[a+21]=t,this.vertices[a+22]=e,this.vertices[a+23]=r,this.vertices[a+24]=i,this.vertices[a+25]=-i,this.vertices[a+26]=s,this.vertices[a+27]=1,this.vertices[a+28]=0,this.vertices[a+29]=t,this.vertices[a+30]=e,this.vertices[a+31]=r}for(let t=0;t<this.indices.length;t+=6)this.indices[t]=a,this.indices[t+1]=a+1,this.indices[t+2]=a+2,this.indices[t+3]=a+1,this.indices[t+4]=a+3,this.indices[t+5]=a+2,a+=4}appendVec2Verices(t,e,r){var i=0;void 0!==this.textureIDHolder[e.id]?i=this.textureIDHolder[e.id]:(this.textureIDHolder[e.id]=this.textures.length,this.textures.push(e));var a=this.count*this.vertexDataCount;this.vertices[a]=t[0].x,this.vertices[a+1]=t[0].y,this.vertices[a+2]=i,this.vertices[a+5]=r[0],this.vertices[a+6]=r[1],this.vertices[a+7]=r[2],this.vertices[a+8]=t[1].x,this.vertices[a+9]=t[1].y,this.vertices[a+10]=i,this.vertices[a+13]=r[3],this.vertices[a+14]=r[4],this.vertices[a+15]=r[5],this.vertices[a+16]=t[2].x,this.vertices[a+17]=t[2].y,this.vertices[a+18]=i,this.vertices[a+21]=r[6],this.vertices[a+22]=r[7],this.vertices[a+23]=r[8],this.vertices[a+24]=t[3].x,this.vertices[a+25]=t[3].y,this.vertices[a+26]=i,this.vertices[a+29]=r[9],this.vertices[a+30]=r[10],this.vertices[a+31]=r[11]}hasRoom(){return this.getLenght()<p}reset(){this.count=-1,this.textureIDHolder={},this.textures.length=0}next(){this.count++}getLenght(){return this.count+1}upload(t){if(!this.isUploaded){if(this.fragmentShaderBuffer=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this.fragmentShaderBuffer,"\n                precision mediump float;\n                uniform sampler2D uSampler[16];\n                varying vec2 uvData;\n                varying vec3 colorVar;\n                varying float textureIDVar;\n                void main() { \n                    \n                    vec4 c;\n                    int f = int(textureIDVar);\n                    if(f == 0) {\n                        c = texture2D(uSampler[0],uvData);\n                    } else if(f == 1) {\n                        c = texture2D(uSampler[1],uvData);\n                    } else if(f == 2) {\n                        c = vec4(1,1,0,1);\n                    } else if(f == 3) {\n                        c = vec4(0,1,0,1);\n                    } \n                    \n                    c.xyz *= colorVar;\n                    gl_FragColor = c;\n                }\n            "),t.compileShader(this.fragmentShaderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}if(this.vertexShaderBuffer=t.createShader(t.VERTEX_SHADER),t.shaderSource(this.vertexShaderBuffer,"\n                uniform mat3 projectionMatrix; \n                uniform mat3 viewMatrix;\n                attribute vec2 position;\n                attribute vec2 uv;\n                attribute vec3 color;\n                attribute float textureID;\n                varying vec3 colorVar;\n                varying vec2 uvData;\n                varying float textureIDVar;\n                void main() {\n                    uvData = uv;\n                    colorVar = color;\n                    textureIDVar = textureID;\n                    vec3 newPos = vec3(position.x, position.y, 1.0 ) * (projectionMatrix * viewMatrix);\n                    gl_Position = vec4(newPos , 1.0);\n                }\n            "),t.compileShader(this.vertexShaderBuffer),!t.getShaderParameter(this.vertexShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.vertexShaderBuffer)}this.shaderProgram=t.createProgram(),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.STREAM_DRAW),this.positionLocation=0,this.textureIDLocation=1,this.uvLocation=2,this.colorLocation=3,t.vertexAttribPointer(this.positionLocation,2,t.FLOAT,!1,32,0),t.enableVertexAttribArray(this.positionLocation),t.vertexAttribPointer(this.textureIDLocation,1,t.FLOAT,!1,32,8),t.enableVertexAttribArray(this.textureIDLocation),t.vertexAttribPointer(this.uvLocation,2,t.FLOAT,!1,32,12),t.enableVertexAttribArray(this.uvLocation),t.vertexAttribPointer(this.colorLocation,3,t.FLOAT,!1,32,20),t.enableVertexAttribArray(this.colorLocation),t.bindAttribLocation(this.shaderProgram,0,"position"),t.bindAttribLocation(this.shaderProgram,1,"textureID"),t.bindAttribLocation(this.shaderProgram,2,"uv"),t.bindAttribLocation(this.shaderProgram,3,"color"),t.attachShader(this.shaderProgram,this.vertexShaderBuffer),t.attachShader(this.shaderProgram,this.fragmentShaderBuffer),t.linkProgram(this.shaderProgram),this.positionLocation=t.getAttribLocation(this.shaderProgram,"position"),this.textureIDLocation=t.getAttribLocation(this.shaderProgram,"textureID"),this.uvLocation=t.getAttribLocation(this.shaderProgram,"uv"),this.colorLocation=t.getAttribLocation(this.shaderProgram,"color"),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.uniform=new u(t,this.shaderProgram),this.isUploaded=!0}}draw(){}}class A extends s{constructor(t,e){super(),this.infoID=0,this.gl=e,this._materials=[],this.square=t,this.typedArray=new Int32Array(16),e.disable(e.STENCIL_TEST),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.regularEffect=new g}prepareForRender(t){this.currentCamera=t,this.currentMaterial=void 0,this.regularEffect.reset(),this.infoID++}renderSprite(t){this.regularEffect.hasRoom()||(this.present3(this.currentCamera),this.regularEffect.reset()),this.regularEffect.upload(this.gl),this.regularEffect.next(),this.regularEffect.appendVec2Verices(t.vertices,t.texture,t.colors)}present3(t){var e=this.gl,r=this.regularEffect;if(!(r.getLenght()<=0)){var i=r.uniform;e.useProgram(r.shaderProgram),i.setValue("projectionMatrix",t.projectionMatrix.matrixArray),i.setValue("viewMatrix",t.worldMatrix.matrixArray);for(var a=r.textures,s=0;s<a.length;s++){var o=a[s];o.upload(e),e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,o.textureBuffer),this.typedArray[s]=s}i.setValue("uSampler[0]",this.typedArray),i.update(this.gl),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,r.vertices),e.vertexAttribPointer(r.positionLocation,2,e.FLOAT,!1,32,0),e.enableVertexAttribArray(r.positionLocation),e.vertexAttribPointer(r.textureIDLocation,1,e.FLOAT,!1,32,8),e.enableVertexAttribArray(r.textureIDLocation),e.vertexAttribPointer(r.uvLocation,2,e.FLOAT,!1,32,12),e.enableVertexAttribArray(r.uvLocation),e.vertexAttribPointer(r.colorLocation,3,e.FLOAT,!1,32,20),e.enableVertexAttribArray(r.colorLocation);var n=6*r.getLenght();e.drawElements(e.TRIANGLES,n,e.UNSIGNED_SHORT,0),this.currentMaterial=void 0}}present2(t){var e=this.gl;if(!e.isContextLost())for(var r=0;r<this._materials.length;r++){var i=this._materials[r],a=i.uniform;e.useProgram(i.shaderProgram),a.setValue("projectionMatrix",t.projectionMatrix.matrixArray),a.setValue("viewMatrix",t.worldMatrix.matrixArray),a.setValue("uSampler",0),a.update(this.gl),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.textureBuffer),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,i.vertices),e.vertexAttribPointer(i.positionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,i.colorBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,i.colors),e.vertexAttribPointer(i.colorLocation,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,i.uvBuffer),e.vertexAttribPointer(i.uvLocation,2,e.FLOAT,!1,0,0);var s=6*i.getLenght();e.drawElements(e.TRIANGLES,s,e.UNSIGNED_SHORT,0),i.reset()}}}var E=0;class R extends v{constructor(t){super(),this.id="id_"+E++,this.isUploaded=!1,this._color=t}upload(t){if(this.fragmentShaderBuffer=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this.fragmentShaderBuffer,"precision mediump float;uniform vec4 color;void main() {   gl_FragColor = color;}"),t.compileShader(this.fragmentShaderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}if(this.vertexSahderBuffer=t.createShader(t.VERTEX_SHADER),t.shaderSource(this.vertexSahderBuffer,"uniform mat3 modelMatrix;uniform mat3 projectionMatrix;uniform mat3 viewMatrix;attribute vec2 position;void main() {   vec3 pos = vec3(position.x,position.y, 1.0);   mat3 m =  projectionMatrix * (modelMatrix * viewMatrix);   vec3 pm = m * pos;   gl_Position = vec4(pm.x,pm.y, 0, 1.0);   gl_PointSize = 10.0;}"),t.compileShader(this.vertexSahderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,this.vertexSahderBuffer),t.attachShader(this.shaderProgram,this.fragmentShaderBuffer),t.linkProgram(this.shaderProgram),this.isUploaded=!0,this.uniform=new u(t,this.shaderProgram),this.color=this._color,this.uniform.setValue("color",this.color.elements)}set color(t){this._color=t}get color(){return this._color}draw(t){this.shaderProgram||this.upload(t),t.useProgram(this.shaderProgram),this.uniform.update(t)}}var S,_=0,T=35e4;class b extends v{constructor(t){super(),this.count=0,this.id="id_"+_++,this.isUploaded=!1,this._color=t,this.offset=new Float32Array(2*T),this.colorArray=new Float32Array(3*T),this.rotateArray=new Float32Array(T);var e=10;this.vertices=[-e,e,-e,-e,e,e,e,-e],this.uv=[0,1,0,0,1,1,1,0],this.indices=[2,1,0,1,3,2],this.color=[Math.random(),Math.random(),Math.random(),1];for(var r=Math.random(),i=Math.random(),a=Math.random(),s=0;s<this.colorArray.length;s+=3)this.colorArray[s]=r,this.colorArray[s+1]=i,this.colorArray[s+2]=a}static getInstance(){return S||(S=new b),S}reset(){this.count=-1}addPosition(t,e){var r=2*this.count;this.offset[r]=t,this.offset[r+1]=e}addRotation(t){this.rotateArray[this.count]=t}next(){this.count++}getLenght(){return this.count+1}upload(t,e){if(!this.isUploaded){var r=document.getElementById("vertexShaderInstanced").textContent,i=document.getElementById("fragmentShaderInstanced").textContent;if(this.fragmentShaderBuffer=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this.fragmentShaderBuffer,i),t.compileShader(this.fragmentShaderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}if(this.vertexSahderBuffer=t.createShader(t.VERTEX_SHADER),t.shaderSource(this.vertexSahderBuffer,r),t.compileShader(this.vertexSahderBuffer),!t.getShaderParameter(this.fragmentShaderBuffer,t.COMPILE_STATUS)){throw"Could not compile WebGL program. \n\n"+t.getShaderInfoLog(this.fragmentShaderBuffer)}this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,this.vertexSahderBuffer),t.attachShader(this.shaderProgram,this.fragmentShaderBuffer),t.linkProgram(this.shaderProgram),t.useProgram(this.shaderProgram),this.uniform=new u(t,this.shaderProgram),this.offsetLocation=t.getAttribLocation(this.shaderProgram,"offset"),this.rotationLocation=t.getAttribLocation(this.shaderProgram,"rotation"),this.colorLocation=t.getAttribLocation(this.shaderProgram,"color"),this.positionLocation=t.getAttribLocation(this.shaderProgram,"position"),this.uvLocation=t.getAttribLocation(this.shaderProgram,"uv"),this.rotateBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.rotateBuffer),t.bufferData(t.ARRAY_BUFFER,this.rotateArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.rotationLocation,1,t.FLOAT,!1,0,0),e.vertexAttribDivisorANGLE(this.rotationLocation,1);var a=t.getAttribLocation(this.shaderProgram,"offset");this.offsetBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.offsetBuffer),t.bufferData(t.ARRAY_BUFFER,this.offset,t.DYNAMIC_DRAW),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),e.vertexAttribDivisorANGLE(a,1);var s=t.getAttribLocation(this.shaderProgram,"color");this.colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.vertexAttribPointer(s,3,t.FLOAT,!1,0,0),e.vertexAttribDivisorANGLE(s,1),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW);var o=this.positionLocation;t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.uvBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.uv),t.STATIC_DRAW),t.vertexAttribPointer(this.uvLocation,2,t.FLOAT,!1,0,0);var n=t.createTexture(),h=window.flame;t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,n),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.isUploaded=!0}}set color(t){this._color=t}get color(){return this._color}draw(){}}class y extends s{constructor(){super(),this.isRotationDirty=!0,this.rotation=0,this.stage=void 0,this.context=void 0,this.isScaleDirty=!0,this.isPositionDirty=!0,this.scaleX=1,this.scaleY=1,this.position=new d(0,0,1),this.needsCalculation=!0,this.rotationMatrix=new l,this.scaleMatrix=new l,this.positionMatrix=new l,this.worldMatrix=new l}setRotation(t){this.rotation=t,this.isRotationDirty=!0}getRotation(){return this.rotation}updateRotation(){this.rotationMatrix.setRotationZ(this.rotation),this.isRotationDirty=!1}updateScale(){this.scaleMatrix.setScale(this.scaleX,this.scaleY),this.isScaleDirty=!1}updatePosition(){this.positionMatrix.translate(this.position.x,this.position.y),this.isPositionDirty=!1}setScale(t){this.scaleX=t,this.scaley=t,this.isScaleDirty=!0}setScaleX(t){this.scaleX=t,this.isScaleDirty=!0}setScaleY(t){this.scaleY=t,this.isScaleDirty=!0}getScaleY(){return this.scaleY}getScaleX(){return this.scaleX}updateWorldMatrix(){this.worldMatrix.makeIdentity(),this.updateScale(),this.updateRotation(),this.updatePosition(),this.worldMatrix.multiplyMatrix(this.positionMatrix),this.worldMatrix.multiplyMatrix(this.rotationMatrix),this.worldMatrix.multiplyMatrix(this.scaleMatrix)}update(){this.updateWorldMatrix()}}class M extends y{constructor(){super(),this.children=[]}addChild(t){if(!(t instanceof y))throw"child should be Object2D instance";t.stage=this.stage,t.parent=this,t.context=this.context,this.children.push(t)}update(){super.update()}}class B extends s{constructor(t){super(),void 0!==t&&(t instanceof WebGLTexture?this.textureBuffer=t:this.setImageUrl(t))}setImageUrl(t){this.url=t,this._srcImage=new Image,this._srcImage.onload=this.onLoadImage.bind(this),this._srcImage.onerror=this.onErrorImage.bind(this),this._srcImage.src=t}onLoadImage(t){this.dispacthEvent(B.COMPLETE,{rawEvent:t})}onErrorImage(t){this.dispacthEvent(B.ERROR,{rawEvent:t})}upload(t){this.textureBuffer||(this.textureBuffer=t.createTexture(),this.textureBuffer.url=this.url,t.bindTexture(t.TEXTURE_2D,this.textureBuffer),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._srcImage),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))}}B.COMPLETE="onImageComplete",B.ERROR="onImageError";class L extends M{static get ENTER_FRAME(){return"enterFrame"}constructor(t){if(super(t),this.allowAutoClear=!0,this.userFrameBuffer=!1,this.min=5e5,this.max=-5e5,this.stage=this,void 0===t)throw"no canvas found";var e=document.getElementById(t),r=e.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!0});if(!r){var i="WebGL isn't supported on device";throw this.dispatchEvent(L.ERROR,{message:i}),i}r.clearColor(1,1,1,1),r.clear(r.COLOR_BUFFER_BIT),this.renderDom=e,r.hasOwnProperty("rawgl")&&(r=r.rawgl),this.setWebGLContext(r),this.init()}init(){this.setAutoUpdate(!0)}setWebGLContext(t){this.context=t,t instanceof WebGLRenderingContext&&(this.renderer=new A(this,t),t.viewport(0,0,this.renderDom.width,this.renderDom.height),t.clearColor(.6,.6,.6,0))}setAutoUpdate(t){var e;this._autoUpdate!==t&&(this._autoUpdate=t,t?(e=this,-1==D.indexOf(e)&&(D.push(e),P||(P=!0,requestAnimationFrame(F)))):function(t){D.splice(D.indexOf(t),1)}(this))}createFrameBufferTexture(){var t=this.context,e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,600,600,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),this.frameBuffer=e,new B(r)}clear(){var t=this.context;t.viewport(0,0,600,600),t.clear(t.COLOR_BUFFER_BIT)}update(){this.dispacthEvent(L.ENTER_FRAME,void 0);var t=this.context;t.bindFramebuffer(t.FRAMEBUFFER,null),this.frameBuffer&&t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.renderer.prepareForRender(this.camera),this.renderReqursively(this.children),this.renderer.present3(this.camera)}renderReqursively(t){for(var e=0;e<t.length;e++)t[e].update(),this.renderReqursively(t[e].children),this.renderer.renderSprite(t[e])}renderEachChildren(){for(var t=0;t<this.children.length;t++)this.children[t].update(),this.renderer.renderSprite(this.children[t])}}var P=!1,D=[];function F(){for(var t=0;t<D.length;t++)D[t].allowAutoClear&&D[t].clear(),D[t].update();D.length>0?requestAnimationFrame(F):P=!1}class U{constructor(t){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=10,this.height=10,this._tx=0,this._ty=0,this._scaleMatrix=new l,this._translateMatrix=new l,this._rotationMatrix=new l,this.worldMatrix=new l,this.a=1,void 0===t&&(t=[1,0,0,0,1,0,0,0,0]),this.elements=new Float32Array(t)}updateWorldMatrix(){this._scaleMatrix.scale(this.scaleX,this.scaleY),this._rotationMatrix.setRotationZ(this.rotation),this._translateMatrix.translate(this.x,this.y),this.worldMatrix.multiplySRTMatrix(this._scaleMatrix,this._rotationMatrix,this._translateMatrix)}}class w extends M{constructor(t){super(),this.translate=new U;var e=16;this.texture=t,this.vertices=[new f(-e,e),new f(-e,-e),new f(e,e),new f(e,-e)],this.size=new f(15,18),this.colors=[],this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1}setTintColor(t,e,r){for(var i=0;i<this.colors.length;i+=3)this.colors[i]=t,this.colors[i+1]=e,this.colors[i+2]=r}setSize(t,e){this.size.x=t,this.size.y=e}getSize(){return this.size}update(){super.update();var t=this.size.y,e=this.size.x*this.scaleX,r=t*this.scaleY,i=this.position.x,a=this.position.y,s=-e,o=r,n=-e,h=-r,c=e,u=r,f=e,d=-r,l=this.rotation,m=Math.cos(l),v=Math.sin(l),x=-v;s=i+s*m+x*o,o=a+-e*v+m*o,n=i+n*m+x*h,h=a+-e*v+m*h,c=i+c*m+x*u,u=a+e*v+m*u,f=i+f*m+x*d,d=a+e*v+m*d;var p=this.vertices[0],g=this.vertices[1],A=this.vertices[2],E=this.vertices[3];p.x=s,p.y=o,g.x=n,g.y=h,A.x=c,A.y=u,E.x=f,E.y=d,this.parent instanceof L||(p.mulMatrix3(this.parent.worldMatrix),g.mulMatrix3(this.parent.worldMatrix),A.mulMatrix3(this.parent.worldMatrix),E.mulMatrix3(this.parent.worldMatrix))}}class I extends y{constructor(){super(),this.projectionMatrix=new l,this.projectionMatrix.makeOrtho(-300,300,-300,300)}updateWorldMatrix(){super.updateWorldMatrix()}}r.d(e,"CoreObject",function(){return i}),r.d(e,"EventableObject",function(){return s}),r.d(e,"UniformObject",function(){return u}),r.d(e,"Vector2",function(){return f}),r.d(e,"Vector3",function(){return d}),r.d(e,"Matrix3",function(){return l}),r.d(e,"Color",function(){return m}),r.d(e,"WebGLRenderer",function(){return A}),r.d(e,"DefaultEffect",function(){return v}),r.d(e,"ColorEffect",function(){return R}),r.d(e,"InstancedMaterial",function(){return b}),r.d(e,"Square",function(){return L}),r.d(e,"Object2D",function(){return y}),r.d(e,"ObjectContainer2D",function(){return M}),r.d(e,"ImageObject",function(){return B}),r.d(e,"NormalSprite",function(){return w}),r.d(e,"Camera",function(){return I})}])});